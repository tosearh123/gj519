"use strict";var container=document.querySelector(".container");$(".tab_1").hover(function(){$(this).addClass("active").siblings().removeClass("active");var t=$(this).index();$(".tab_2").eq(t).addClass("active").siblings().removeClass("active")});var huan,tou=document.querySelector(".tou"),login=getCookie("login");function render(t){var e,n,a;t.length?(e=t.every(function(t){return 1==t.is_select}),n=shopNum(t),a='<div class="contain">\n    <section class="container_top">\n        <p class="all"><input  id="all" type="checkbox" '+(e?"checked":"")+'></p>\n        <p class="shang"><span> 商品</span></p>\n        <p class="prices"><span>商品单价</span></p>\n        <p class="counts"><span>数量</span></p>\n        <p class="much"><span>小计</span></p>\n        <p class="handle"><span>操作</span></p>\n    </section>\n   ',a+=' <section class="container_cen">',t.forEach(function(t){a+='<div class="shop">\n        <div class="only"><input class="checks" type="checkbox" '+(1==t.is_select?"checked":"")+' cateId="'+t.cateId+'"></div>\n        <div class="cen_box">\n            <div class="box_left">\n                <img src="'+t.pic+'" alt="">\n            </div>\n            <div class="box_right">\n                <p>'+t.name+'</p>\n                <p>产品规格：50°,1瓶</p>\n            </div>\n        </div>\n        <div class="price">\n            <p>￥'+t.price+"</p>\n            <p>￥"+t.price+'</p>\n        </div>\n        <div class="count" cateId="'+t.cateId+'">\n            <button class="reduce">-</button>\n            <input min="1" type="number" readonly value="'+t.cart_number+'" class="numbers">\n            <button class="add">+</button>\n        </div>\n        <div class="zjia">\n            <p>￥'+t.price*t.cart_number+'</p>\n        </div>\n        <div class="handles">\n            <button class="del"  cateId="'+t.cateId+'">删除</button>\n        </div>\n    </div>'}),a+='</section>\n   </div>\n   <section class="container_bot">\n        <div class="xzhong">\n            <span class="shanchu">\n                删除选中商品\n            </span>\n        </div>\n       <div class="hji">\n           <div class="hji_l">\n               <p>\n                   合计（不含运费）：\n                   <span>￥：'+n.totalPrice+'</span>\n               </p>\n           </div>\n           <div class="hji_r">\n               立即结算\n           </div>\n       </div>\n   </section>',container.innerHTML=a):container.innerHTML='<div class="contain">\n        <section class="container_top">\n            <p class="all"><input type="checkbox"></p>\n            <p class="shang"><span> 商品</span></p>\n            <p class="prices"><span>商品单价</span></p>\n            <p class="counts"><span>数量</span></p>\n            <p class="much"><span>小计</span></p>\n            <p class="handle">\n            <span>操作</span></p>\n        </section>\n        <div class="kong">无购买商品，请前往选购</div>\n        </div> \n        <section class="container_bot">\n        <div class="xzhong">\n            <span class="shanchu">\n                删除选中商品\n            </span>\n        </div>\n        <div class="hji">\n            <div class="hji_l">\n                <p>\n                    合计（不含运费）：\n                    <span>￥：0.00</span>\n                </p>\n            </div>\n            <div class="hji_r">\n                立即结算\n            </div>\n        </div>\n    </section>'}function shopNum(t){return{totalPrice:t.filter(function(t){return 1==t.is_select}).reduce(function(t,e){return t+e.price*e.cart_number},0)}}login?(tou.innerHTML=login+'<b class="huan">[退出]</b>',(huan=document.querySelector(".huan")).onclick=function(){console.log(1),delCookie("login"),tou.innerHTML=' <li class="login"><a href="../html/login.html"> 登录</a> </li>\n    <i>|</i>\n    <li class="zhuce"><a href="../html/register.html">注册</a> </li>',location.href="../html/login.html",localStorage.setItem("url","../html/car.html")}):(location.href="../html/login.html",localStorage.setItem("url","../html/car.html")),pAjax({url:"../api/getCarData.php",data:{tel:login}}).then(function(t){localStorage.setItem("goodsList",JSON.stringify(t)),render(t)}),container.onclick=function(){var e,t,n,a,s,c,i,o,r=window.event;if("all"==r.target.id&&((t=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){r.target.checked?t.is_select=1:t.is_select=0}),localStorage.setItem("goodsList",JSON.stringify(t)),render(t)),"checks"==r.target.className&&(e=r.target.getAttribute("cateId"),(t=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){t.cateId==e&&(t.is_select=r.target.checked?1:0)}),localStorage.setItem("goodsList",JSON.stringify(t)),render(t)),"add"==r.target.className&&(n=JSON.parse(localStorage.getItem("goodsList")),a=r.target.parentNode.getAttribute("cateId"),s=n.filter(function(t){return t.cateId==a})[0],c=+s.cart_number,c++,pAjax({url:"../api/updCarData.php",data:{tel:login,cateId:a,goods_nums:c}}).then(function(t){t.code&&(s.cart_number=c,localStorage.setItem("goodsList",JSON.stringify(n)),render(n))})),"reduce"==r.target.className){var l=JSON.parse(localStorage.getItem("goodsList")),d=r.target.parentNode.getAttribute("cateId"),p=l.filter(function(t){return t.cateId==d})[0],u=+p.cart_number;if(r.target.nextElementSibling.value<=1)return r.target.nextElementSibling.value=1;u--,pAjax({url:"../api/updCarData.php",data:{tel:login,cateId:d,goods_nums:u}}).then(function(t){t.code&&(p.cart_number=u,localStorage.setItem("goodsList",JSON.stringify(l)),render(l))})}if("del"==r.target.className&&(i=r.target.getAttribute("cateId"),pAjax({url:"../api/removeCarData.php",data:{tel:login,cateId:i}}).then(function(t){var e;t.code&&(t=(e=JSON.parse(localStorage.getItem("goodsList"))).filter(function(t){return t.cateId!=i}),console.log(e),localStorage.setItem("goodsList",JSON.stringify(t)),render(t))})),"shanchu"==r.target.className){var g=JSON.parse(localStorage.getItem("goodsList"));if(g.every(function(t){return 0==t.is_select}))return;var h=g.filter(function(t){return 0==t.is_select});g.forEach(function(t){1==t.is_select&&pAjax({url:"../api/removeCarData.php",data:{tel:login,cateId:t.cateId}}).then(function(t){t.code&&(localStorage.setItem("goodsList",JSON.stringify(h)),render(h))})})}"hji_r"==r.target.className&&((g=JSON.parse(localStorage.getItem("goodsList"))).every(function(t){return 0==t.is_select})||(o=g.filter(function(t){return 0==t.is_select}),g.forEach(function(t){1==t.is_select&&pAjax({url:"../api/removeCarData.php",data:{tel:login,cateId:t.cateId}}).then(function(t){t.code&&(localStorage.setItem("goodsList",JSON.stringify(o)),render(o))})}),alert("结算成功")))};